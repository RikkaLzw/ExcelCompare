# Excel 智能对比工具 (ExcelCompare)

一款功能强大的 Excel 文件比较工具，支持智能匹配、可视化差异展示和详细比较报告。

## ✨ 主要特性

### 🎯 智能匹配
- **主键列匹配** - 根据主键列（如订单ID）智能匹配行，即使行顺序不同也能准确比较
- **复合主键** - 支持使用两列组合作为主键，处理更复杂的数据结构
- **标题行匹配** - 根据列标题自动匹配列，即使列顺序调整也能正确对应
- **外部标题行** - 标题行不在选区内时，自动从工作表读取标题进行匹配
- **贪婪匹配算法** - 当同一主键有多行时，按位置距离最小优先匹配

### 📊 可视化对比
- **双栏并排显示** - 左右对比，差异一目了然
- **颜色高亮** - 新增（绿色）、删除（红色）、修改（黄色）
- **同步滚动** - 可选的同步滚动功能，方便查看对应位置
- **单元格联动** - 点击一个表格的单元格，自动定位到另一个表格的对应位置
- **差异导航** - 快速跳转到上一个/下一个差异

### 🔍 灵活比较
- **全表比较** - 比较整个工作表的所有数据
- **选区比较** - 只比较选中的区域，提高效率
- **多工作表** - 支持比较多个工作表
- **忽略选项** - 可选忽略大小写、空格、空行等

### 📄 报告导出
- **Excel 报告** - 导出带颜色标记的 Excel 文件
- **HTML 报告** - 生成可交互的 HTML 报告
- **详细统计** - 显示新增、删除、修改的数量统计

## 🚀 快速开始

### 安装依赖

```bash
pip install -r requirements.txt
```

### 运行程序

```bash
python main.py
```

### 打包为可执行文件

```bash
pyinstaller --onefile --windowed --name "ExcelCompare" main.py
```

## 📖 使用说明

### 基础比较

1. **加载文件**
   - 点击"打开 A"和"打开 B"按钮，或直接拖拽文件到面板
   - 支持 `.xlsx` 和 `.xls` 格式

2. **配置比较方式**
   - 选择要比较的工作表
   - 设置主键列（如：第1列为订单ID）
   - 设置标题行（如：第1行为列标题）
   - 选择忽略选项（大小写、空格等）

3. **开始比较**
   - 点击"开始比较"按钮
   - 查看差异统计和可视化结果

### 智能匹配示例

**场景：两个文件的行顺序不同**

文件A：
```
订单ID  客户    金额
ORD002  李四    1495
ORD001  张三    11998
ORD003  王五    3897
```

文件B：
```
订单ID  客户    金额
ORD001  张三    11998
ORD002  李四    1734
ORD003  王五    3897
```

**配置：**
- 主键列：第1列（订单ID）
- 标题行：第1行

**结果：**
- 程序会根据订单ID匹配对应行
- ORD002 的金额从 1495 变为 1734（修改）
- 主键列本身不会被报告为差异

### 选区比较

1. **选择区域**
   - 在两个表格中分别拖拽选择要比较的区域
   - 选区列数必须相同

2. **使用配置面板的匹配方式**
   - 选区比较会自动使用配置面板中的主键列和标题行设置
   - 如果标题行不在选区内，程序会自动从工作表读取

3. **点击"比较选中区域"**

### 单元格联动

- 点击文件A的任意差异单元格，文件B会自动定位到对应位置
- 反之亦然
- 只对修改类型的差异有效（新增和删除没有对应关系）

## 🛠️ 技术栈

- **Python 3.8+**
- **PyQt6** - 图形界面
- **openpyxl** - 读写 .xlsx 文件
- **xlrd** - 读取 .xls 文件

## 📁 项目结构

```
compare_tabel/
├── main.py                 # 程序入口
├── requirements.txt        # 依赖列表
├── CLAUDE.md              # 项目说明（给 AI 的指引）
├── src/
│   ├── models/            # 数据模型
│   │   ├── excel_model.py    # Excel 数据结构
│   │   └── diff_model.py     # 差异结果模型
│   ├── services/          # 业务逻辑
│   │   ├── excel_service.py  # Excel 文件读取
│   │   ├── compare_service.py # 比较算法
│   │   └── report_service.py  # 报告导出
│   ├── views/             # 界面组件
│   │   ├── main_window.py    # 主窗口
│   │   ├── diff_view.py      # 差异视图
│   │   ├── config_panel.py   # 配置面板
│   │   ├── file_panel.py     # 文件面板
│   │   ├── diff_list.py      # 差异列表
│   │   └── stats_panel.py    # 统计面板
│   └── workers/           # 后台任务
│       └── compare_worker.py # 比较工作线程
└── resources/             # 资源文件
    └── icon.svg          # 应用图标
```

## 🔧 开发说明

### 核心算法

**主键匹配流程：**
1. 提取两个文件的主键列，建立主键索引
2. 对于每个主键，找到两个文件中的所有匹配行
3. 使用贪婪算法按位置距离最小优先配对
4. 比较匹配的行（跳过主键列本身）
5. 未匹配的行标记为整行删除/新增

**标题行匹配流程：**
1. 读取两个文件的标题行
2. 建立列名到列索引的映射
3. 根据列名匹配对应的列
4. 比较时使用列映射关系

### 添加新功能

参考 `CLAUDE.md` 文件中的架构说明和开发指引。

## 💝 关于

这个工具是为了帮助处理大量表格差异而开发的。希望它能让你的工作更轻松，少加点班，多睡点觉~ 😊

## 📄 许可证

MIT License

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

---

**如果这个工具帮到了你，请给个 ⭐ Star 支持一下！**
